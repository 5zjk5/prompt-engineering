# 项目介绍
本项目利用通义大模型对评论数据进行情感分析，并输出结果。
使用 langchain 加载模型，并调用 prompt 链。
使用 langchain 的批次调用技术，加快速度。


# 文件目录
code：存放所有代码<br>
data：存放数据<br>
output：输出的结果文件


# tongyi 系列模型评测结果
调试 prompt 使用前 100 条数据，评测结果如下：<br>
prompt 都是相同的，temperture=1

|               | 准确率  |
|---------------|------|
| qwen-plus     | 0.89 |
| qwen-turbo    | 0.82 |
| qwen-7b-chat  | 0.80 |
| qwen-14b-chat | 0.83 |

结论：模型越好，效果也越好，稍微弱一些的模型也能通过调优 prompt，也能获得更好的结果

# prompt 调优
使用 qwen-14b-chat 进行调，
以下是准确率 0.83 的 prompt：
```js
角色设定：
你是一个情感分析专家，擅长通过情感分析技术，给出情感分析结果。

背景：
有一些商品的评论数据，现在需要判断每一条评论是积极的，还是属于消极的。

任务：
给你提供一段评论的文本，你需要判断这段评论是属于积极的，还是属于消极的。

输出：
- 如果判断为积极的，请输出`Positive`，不需要输出理由及其他任何信息。
- 如果判断为消极的，请输出`Negative`，不需要输出理由及其他任何信息。

以下是需要判断的文本：
`{sentenece}`
```

以下是准确率 0.86 的 prompt，利用网页版通义进行优化，详情优化链接：<br>
https://tongyi.aliyun.com/qianwen/share?shareId=a183f8a6-712f-4265-9925-0e91572b1549：
```js
**角色身份：**
作为情感倾向鉴定专家，你利用情感分析技巧来判定文本的情感色彩。

**任务概述：**
针对一系列商品评论，你的职责是迅速识别每条评论的情感倾向——是积极正面还是消极负面。

**执行指南：**
- 针对每段给定的评论文本，进行情感倾向判断。
- 若评论表达的是积极情绪，直接输出：Positive
- 若评论倾向于消极情绪，直接输出：Negative
- 输出时无需附带任何解释或额外信息。

**待分析评论样本：**
{sentenece}

请依据上述准则，对提供的评论进行情感倾向判断并给出简洁的响应。
```

分析 badcase 发现，模型在判断负向情感时，可能会输出中立的情感，加条规则，准确率 0.88：<br>
```js
**角色身份：**
作为情感倾向鉴定专家，你利用情感分析技巧来判定文本的情感色彩。

**任务概述：**
针对一系列商品评论，你的职责是迅速识别每条评论的情感倾向——是积极正面还是消极负面。

**执行指南：**
- 针对每段给定的评论文本，进行情感倾向判断。
- 若评论表达的是积极情绪，直接输出：Positive
- 若评论倾向于消极情绪，直接输出：Negative
- 输出时无需附带任何解释或额外信息。
- 必须选择输出“Positive”或“Negative”，例如`跑步很合适，但是做工不佳，连接性也不是很便利`这段文本虽然说是正面情绪，但是实际是负面情绪，所以应该输出Negative。

**待分析评论样本：**
{sentenece}

请依据上述准则，对提供的评论进行情感倾向判断并给出简洁的响应。
```

# badcase 分析
把准确率 0.88 的预测错误的拿出来，看看到底是真的预测错了，还是标注 label 不合适。
分析发现，有 6 条，不太合适，例如：
```js
不知道电池不给力还是手机不给力(*￣m￣)充电好慢
```
这 label 是 Positive，但是实际是 Negative，那这种就不合适。<br>

把不合适的改掉后，准确率 **0.94**


# 批次耗时对比
批次数量为 3

|               | time_used |
|---------------|-----------|
| base_llm_chain    | 89s       |
| batch_base_llm_chain    | 39s       |
